<%= render 'lists/navbar' %>
<! –– display add item form ––> 
<table class = "table table-bordered"> 
<% if current_or_guest_user %>
  <p><%= render 'form_index' %></p>
  <% if !params[:tag] %>
    <%= render 'search' %>
  <% end %>
  <%= link_to 'Back', lists_path %>&nbsp&nbsp&nbsp&nbsp 
  <%= sort_link(@q, :description) %>&nbsp&nbsp&nbsp&nbsp
  <%= sort_link(@q, :ddl) %>&nbsp&nbsp&nbsp&nbsp
  <% if params[:tag] %>
  <% else %>
    <%= link_to 'Delete Marked Items', home_trash_em_path, data: { confirm: 'Are you sure?' } %> &nbsp&nbsp&nbsp&nbsp
    <%= link_to 'Delete All Items', home_trash_em_all_path, data: { confirm: 'Are you sure?' } %> &nbsp&nbsp&nbsp&nbsp
    <a href="javascript:toggleDiv('myContent');" >View Overdue</a><p></p>
  <% end %>
<% end %> 
  <tbody>
    <% @lists.each do |list| %>  
      <% if list.completed && list.ddl >= Date.yesterday %>
      <% if current_or_guest_user && list.user == current_or_guest_user %>
      <tr class = "table-secondary">
        <td class = "striker"><%= link_to list.description, edit_list_path(list) %></td>
        <td class = "striker"><%= link_to list.ddl.strftime("%-d/%-m/%y"), edit_list_path(list) %></td>
        <td class = "striker"><p><%= raw list.tag_list.map{ |t| link_to t, tag_path(t) }.join(', ') %></p></td>
        <td>
          <center>
            <%= form_for(list) do |f| %>
            <%= f.text_field :description, type: 'hidden'  %>
            <% f.date_field :ddl, type: 'hidden'  %>
            <%= f.check_box :completed, :checked => false, :style => 'visibility: hidden'%>
            <%= f.submit "Uncross", class: 'btn btn-outline-secondary btn-sm' %>      
            <% end %>
          </center>
        </td>
        <td><%= link_to 'Delete', list, class: 'btn btn-outline-danger btn-sm', method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
        </tr>

      <% else %>
      <%if current_or_guest_user && list.user == current_or_guest_user && list.ddl > Date.yesterday%>
      <tr>
        <td><%= link_to list.description, edit_list_path(list) %></td> 
        <td><%= link_to list.ddl.strftime("%-d/%-m/%y"), edit_list_path(list) %></td>
        <td><p><%= raw list.tag_list.map{ |t| link_to t, tag_path(t) }.join(', ') %></p></td>
        <td>
          <center>
            <%= form_for(list) do |f| %>
            <%= f.text_field :description, type: 'hidden'  %>
            <%= f.date_field :ddl , type: 'hidden'  %>
            <%= f.check_box :completed, :checked => true, :style => 'visibility: hidden'%>
            <%= f.submit "Cross Off", class: 'btn btn-outline-secondary btn-sm' %>
          </center>
        </td>
        <td><%= link_to 'Delete', list, class: 'btn btn-outline-danger btn-sm', method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
      <% end %>
      <% end %>
      <% end %>
    <% end %>
  </tbody>
</table>

<br>
<div id="myContent">
  <p style="color:red">Overdue</p>
<% if List.order('ddl').where(['ddl < ?', Date.yesterday]).count < 1 %>
  <p>No overdues</p>
<% end %>
<table class = "table table-bordered">
<tbody>
    <% @lists.each do |list| %>  
      <% if list.completed && list.ddl < Date.yesterday%>
      <% if current_or_guest_user && list.user == current_or_guest_user %>
      <tr class = "table-secondary">
        <td class = "striker"><%= link_to list.description, edit_list_path(list) %></td>
        <td class = "striker"><%= link_to list.ddl.strftime("%-d/%-m/%y"), edit_list_path(list) %></td>
        <td class = "striker"><p><%= raw list.tag_list.map{ |t| link_to t, tag_path(t) }.join(', ') %></p></td>
        <td>
          <center>
            <%= form_for(list) do |f| %>
            <%= f.text_field :description, type: 'hidden'  %>
            <% f.date_field :ddl, type: 'hidden'  %>
            <%= f.check_box :completed, :checked => false, :style => 'visibility: hidden'%>
            <%= f.submit "Uncross", class: 'btn btn-outline-secondary btn-sm' %>      
            <% end %>
          </center>
        </td>
        <td><%= link_to 'Delete', list, class: 'btn btn-outline-danger btn-sm', method: :delete, data: { confirm: 'Are you sure?' } %></td>
        <% end %>
        </tr>

      <% else %>
      <%if current_or_guest_user && list.user == current_or_guest_user && list.ddl < Date.yesterday %>
      <tr>
        <td><%= link_to list.description, edit_list_path(list) %></td> 
        <td><%= link_to list.ddl.strftime("%-d/%-m/%y"), edit_list_path(list) %></td>
        <td><p><%= raw list.tag_list.map{ |t| link_to t, tag_path(t) }.join(', ') %></p></td>
        <td>
          <center>
            <%= form_for(list) do |f| %>
            <%= f.text_field :description, type: 'hidden'  %>
            <%= f.date_field :ddl , type: 'hidden'  %>
            <%= f.check_box :completed, :checked => true, :style => 'visibility: hidden'%>
            <%= f.submit "Cross Off", class: 'btn btn-outline-secondary btn-sm' %>
          </center>
        </td>
        <td><%= link_to 'Delete', list, class: 'btn btn-outline-danger btn-sm', method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
      <% end %>
      <% end %>
      <% end %>
    <% end %>
  </tbody>

<! –– toggle the display ––> 
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
<script type="text/javascript">
function toggleDiv(divId) {
   $("#"+divId).toggle();
}
</script>

